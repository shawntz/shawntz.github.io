---
import { getCollection } from 'astro:content';

// Get latest blog posts
const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
const latestPosts = sortedPosts.slice(0, 3);

function formatDate(date: Date) {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  }).format(date);
}
---

<section class="relative overflow-hidden py-12 sm:py-16 lg:py-20">
  <div class="max-w-[1800px] mx-auto px-8 sm:px-12 lg:px-20 xl:px-28 2xl:px-32">
    <!-- Section Header -->
    <div class="mb-8 md:mb-12 flex items-end justify-between">
      <div class="hero-highlight-header opacity-0">
        <p class="label text-accent-primary mb-2">Latest Updates</p>
        <h2 class="heading-2">Recent Work & Insights</h2>
        <p class="body text-ink-secondary mt-2 max-w-2xl">
          Exploring the intersection of AI, neuroscience, and software engineering
        </p>
      </div>
      <a
        href="/blog"
        class="hero-highlight-cta opacity-0 hidden sm:flex items-center gap-2 text-accent-primary hover:text-accent-primary-hover transition-colors group"
      >
        <span class="font-medium">View all</span>
        <svg
          class="w-4 h-4 transition-transform group-hover:translate-x-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          ></path>
        </svg>
      </a>
    </div>

    <!-- Highlights Grid -->
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        latestPosts.map((post, index) => (
          <a
            href={`/blog/${post.slug}`}
            class={`hero-highlight-card hero-highlight-card-${index} opacity-0 group relative block`}
            data-astro-prefetch
          >
            <div class="card card-interactive h-full overflow-hidden">
              {/* Featured Badge */}
              {post.data.featured && (
                <div class="absolute top-4 right-4 z-10">
                  <span class="tag tag-amber text-xs font-medium">
                    Featured
                  </span>
                </div>
              )}

              {/* Hero Image */}
              {post.data.heroImage && (
                <div class="aspect-video overflow-hidden bg-surface-tertiary">
                  <img
                    src={post.data.heroImage}
                    alt={post.data.title}
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                  />
                </div>
              )}

              {/* Content */}
              <div class="p-6">
                {/* Meta */}
                <div class="flex items-center gap-3 text-sm text-ink-tertiary mb-3">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {formatDate(post.data.pubDate)}
                  </time>
                  {post.data.readTime && (
                    <>
                      <span class="w-1 h-1 rounded-full bg-ink-tertiary" />
                      <span>{post.data.readTime}</span>
                    </>
                  )}
                </div>

                {/* Title */}
                <h3 class="heading-3 mb-2 group-hover:text-accent-primary transition-colors">
                  {post.data.title}
                </h3>

                {/* Description */}
                <p class="body-small text-ink-secondary line-clamp-2 mb-4">
                  {post.data.description}
                </p>

                {/* Tags */}
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {post.data.tags.slice(0, 3).map((tag) => (
                      <span class="tag text-xs">{tag}</span>
                    ))}
                  </div>
                )}

                {/* Read More Indicator */}
                <div class="mt-4 flex items-center gap-2 text-accent-primary font-medium text-sm group-hover:gap-3 transition-all">
                  <span>Read more</span>
                  <svg
                    class="w-4 h-4 transition-transform group-hover:translate-x-1"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 8l4 4m0 0l-4 4m4-4H3"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </a>
        ))
      }
    </div>

    <!-- Mobile View All Button -->
    <div class="mt-8 sm:hidden flex justify-center">
      <a href="/blog" class="btn btn-secondary">
        <span>View all updates</span>
        <svg
          class="w-4 h-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          ></path>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  /* Entrance Animations */
  .hero-highlight-header {
    animation: slideInFromLeft 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s forwards;
  }

  .hero-highlight-cta {
    animation: fadeIn 0.6s ease-out 0.4s forwards;
  }

  .hero-highlight-card-0 {
    animation: slideInFromBottom 0.7s cubic-bezier(0.16, 1, 0.3, 1) 0.3s forwards;
  }

  .hero-highlight-card-1 {
    animation: slideInFromBottom 0.7s cubic-bezier(0.16, 1, 0.3, 1) 0.45s forwards;
  }

  .hero-highlight-card-2 {
    animation: slideInFromBottom 0.7s cubic-bezier(0.16, 1, 0.3, 1) 0.6s forwards;
  }

  @keyframes slideInFromLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideInFromBottom {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
