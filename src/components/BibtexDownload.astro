---
import { generateBibtexFromPubs } from '../utils/bibtex';

// Generate BibTeX content at build time
const bibtexContent = await generateBibtexFromPubs();
---

<div class="bibtex-download">
  <button 
    id="download-bibtex" 
    class="neobrutalist-card bg-gradient-to-r from-green-100 to-blue-100 dark:from-green-900 dark:to-blue-900 p-4 hover:shadow-brutal-lg transition-all duration-200 border-3 border-black cursor-pointer"
    data-bibtex={bibtexContent}
  >
    <div class="flex items-center gap-3">
      <div class="text-2xl">ðŸ“„</div>
      <div>
        <h3 class="font-bold text-lg text-gray-900 dark:text-white">Download BibTeX</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400">Export all publications as .bib file</p>
      </div>
    </div>
  </button>
</div>

<script>
  function downloadBibtex(content: string, filename: string = 'schwartz_publications.bib') {
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const downloadBtn = document.getElementById('download-bibtex');
    if (downloadBtn) {
      downloadBtn.addEventListener('click', () => {
        const bibtexContent = downloadBtn.getAttribute('data-bibtex');
        if (bibtexContent) {
          downloadBibtex(bibtexContent);
        }
      });
    }
  });
</script>

<style>
  .bibtex-download {
    margin: 2rem 0;
  }

  #download-bibtex:hover {
    transform: translate(-2px, -2px);
  }

  #download-bibtex:active {
    transform: translate(0, 0);
    box-shadow: 3px 3px 0px 0px rgba(0,0,0,1) !important;
  }
</style>